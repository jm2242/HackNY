<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<meta charset="utf-8">
		<title>TwiTrends</title>
		<meta name="generator" content="Bootply" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<!--[if lt IE 9]>
			<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<link href="css/styles.css" rel="stylesheet">
	</head>
	<body>
<!-- begin template -->
<div class="navbar navbar-custom navbar-fixed-top">
 <div class="navbar-header"><a class="navbar-brand" href="#">TwiTrends - What's going on in Harlem?</a>
      <a class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="active"><a href="#">Home</a></li>
        <li><a href="#">Topic1</a></li>
        <li><a href="#">Topic2</a></li>
        <li>&nbsp;</li>
      </ul>
      <form class="navbar-form">
        <div class="form-group" style="display:inline;">
          <div class="input-group">
            <div class="input-group-btn">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-chevron-down"></span></button>
              <ul class="dropdown-menu">
                <li><a href="#">Category 1</a></li>
                <li><a href="#">Category 2</a></li>
                <li><a href="#">Category 3</a></li>
                <li><a href="#">Category 4</a></li>
                <li><a href="#">Category 5</a></li> 
              </ul>
            </div>
            <input type="text" class="form-control" placeholder="What are searching for?">
            <span class="input-group-addon"><span class="glyphicon glyphicon-search"></span> </span>
          </div>
        </div>
      </form>
    </div>
</div>

<div id="map-canvas"></div>
<div class="container-fluid" id="main">
  <div class="row">
  	<div class="col-xs-4" id="left">
    
      <h3>Trending topics in your area</h3>
      
      <!-- item list -->
      <div class="panel panel-default">
        <div class="panel-heading"><a href="">Trend 1</a></div>
      </div>
      <p>Description of certain topic, current trend, ...</p>
      
      <hr>

      <div class="panel panel-default">
        <div class="panel-heading"><a href="">Trend 2</a></div>
      </div>
      <p>Description of certain topic, current trend, ...</p>
      
      <hr>

      <div class="panel panel-default">
        <div class="panel-heading"><a href="">Trend 3</a></div>
      </div>
      <p>Description of certain topic, current trend, ...</p>
      
      <hr>   
    </div>

    <div class="col-xs-8"><!--map-canvas will be postioned here-->

    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEI4Da8Gny3sOfJysDIT3eZ7M7m5P6sXA">
    </script>
    <script type="text/javascript">

    function pollTweets() {
      setTimeout(function(){
        requestTweets();
      }, 5000);
    };

    tweetData = {};
    map = {};
    my_markers = [];
    info_windows = [];
    contentStringArray=[]
    google.maps.event.addDomListener(window, 'load', initialize);

    function requestTweets() {
      $.ajax({
        type: 'GET',
        url: '../getTweets',
        //contentType: 'application/json; charset=utf-8',
        success: function(data) {
          console.log(data)

          //document.getElementById("demo").innerHTML = data[0]['locationx']
          tweetData = data;
          console.log("Map gonna be used")
          setMarkers(map, tweetData);
          
        }, 
            // Overlay function stuff happens here
        //error: playSound,
        dataType: 'json'
      });
    }
    

    function initialize() {
      var pos1 = new google.maps.LatLng(40.7427,-74.0059);
      var pos2 = new google.maps.LatLng(40.7127,-74.0259);
      var goldStar = {
        path: 'M 125,5 155,90 245,90 175,145 200,230 125,180 50,230 75,145 5,90 95,90 z',
        fillColor: "yellow",
        fillOpacity: 0.8,
        scale: 0.1,
        strokeColor: "gold",
        strokeWeight: 14
      };

      var mapOptions = {
        zoom: 16,
        center: {lat: 40.8075, lng: -73.9619},
      }

      map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
      console.log("Map set")
      pollTweets();
      

      var marker = new google.maps.Marker({
          position: pos1,
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 10,
          },
          map: map,
          title: 'Hello World!'
      });
      var marker2 = new google.maps.Marker({
          position: pos2,
          icon: goldStar,
          map: map,
          title: 'Hello World!'
      });


      var contentString = '<div id="content">'+
      '<div id="siteNotice">'+
      '</div>'+
      '<h3 id="firstHeading" class="firstHeading">Trending keyword</h3>'+
      '<div id="bodyContent">'+
      '<p><b>Trending keyword</b>, also referred to as <b>Ayers Rock</b>, is a large sandstone rock formation. <p>'+
      '<a href="https://en.wikipedia.org/w/index.php?title=Trending keyword&oldid=297882194">'+
      'https://en.wikipedia.org/w/index.php?title=Trending keyword</a> '+
      '(last visited June 22, 2009).</p>'+
      '</div>'+
      '</div>';

      var infowindow = new google.maps.InfoWindow({
      content: contentString
      });
      google.maps.event.addListener(marker, 'click', function() {
      infowindow.open(map,marker);
      });
    }

    var keywords = [
      ['Restaurant', 40.7127, -74.0059, 1, "Content1"],
      ['Club', 40.7327, -74.0259, 2, "Content2"],
      ['Crime', 40.7027, -74.0459, 3, "<h4>Crime Keyword</h4> <p> This is a Crime happening"]
    ];

    


    function setMarkers(map, locations) {
      console.log(locations)
      for (var i = 0; i < locations.length; i++) {

          console.log("Inside setMarkers")
          console.log(locations[i])
          var keyword = locations[i];
          var myLatLng = new google.maps.LatLng(keyword['locationy'], keyword['locationx']);
          contentStringArray.push(keyword['text'])
          var marker = new google.maps.Marker({
              position: myLatLng,
              map: map,
              icon: {
                  path: google.maps.SymbolPath.CIRCLE,
                  scale: 10,
                },
              title: keyword['time'],
              
          }
          );



          marker.info = new google.maps.InfoWindow({
          content: contentStringArray[i]
          });
          
          my_markers.push(marker);

          setTimeout(function(){console.log(my_markers)}, 3000)
          

          google.maps.event.addListener(my_markers[i], 'click', function() {
          this.info.open(map,my_markers[i]);
          });
        
        

      }

      //myString = ""
      //for (var i = 0; i < contentStringArray.length; i++){
        //myString = myString + " " + contentStringArray[i];
      //}
        //$.ajax({
        //type: 'POST',
        //url: '../analyzeText',
        //data: {'data':myString},
        //contentType: 'application/json; charset=utf-8',
        //success: function(data) {
          //console.log(data)
          //document.getElementById("demo").innerHTML = data[0]['locationx']
          
        //}, 
            // Overlay function stuff happens here
        //error: playSound,
        //dataType: 'json'
      //}); 
      



    }



    


 



    </script>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/scripts.js"></script>  
  </div>   
</div>
<!-- end template -->

	<!-- script references 
		<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="http://maps.googleapis.com/maps/api/js?sensor=false&extension=.js&output=embed"></script>
		<script src="js/scripts.js"></script>
  -->

	</body>
</html>